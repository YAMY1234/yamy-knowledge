#!/usr/bin/env python3
"""
è¡¥å…¨ç¼ºå°‘çš„_category_.jsonæ–‡ä»¶çš„è„šæœ¬
"""

import json
from pathlib import Path

def create_missing_category_files():
    """ä¸ºç¼ºå°‘_category_.jsonçš„ç›®å½•åˆ›å»ºè¿™äº›æ–‡ä»¶"""
    
    # åŸºç¡€è·¯å¾„
    base_path = Path("docs")
    
    # éœ€è¦æ·»åŠ _category_.jsonçš„ç›®å½•é…ç½®
    missing_categories = {
        "llm-infra": {
            "label": "LLMåŸºç¡€è®¾æ–½",
            "position": 3,
            "description": "å­¦ä¹ LLMçš„åŸºç¡€è®¾æ–½å»ºè®¾ï¼ŒåŒ…æ‹¬è®­ç»ƒã€æ¨ç†ä¼˜åŒ–ä¸éƒ¨ç½²ã€‚"
        },
        "llm-infra/inference-optimization": {
            "label": "æ¨ç†ä¼˜åŒ–è¯¦è§£",
            "position": 2,
            "description": "æ·±å…¥äº†è§£LLMæ¨ç†ä¼˜åŒ–çš„å„ç§ç­–ç•¥ä¸æŠ€æœ¯ã€‚"
        }
    }
    
    print("å¼€å§‹è¡¥å…¨ç¼ºå°‘çš„_category_.jsonæ–‡ä»¶...")
    print("=" * 50)
    
    for dir_path, config in missing_categories.items():
        full_path = base_path / dir_path
        category_file = full_path / "_category_.json"
        
        # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
        if not full_path.exists():
            print(f"âš ï¸  ç›®å½•ä¸å­˜åœ¨: {full_path}")
            continue
            
        # æ£€æŸ¥_category_.jsonæ˜¯å¦å·²å­˜åœ¨
        if category_file.exists():
            print(f"âœ… å·²å­˜åœ¨: {category_file}")
            continue
        
        # åˆ›å»º_category_.jsonæ–‡ä»¶
        category_config = {
            "label": config["label"],
            "position": config["position"],
            "link": {
                "type": "generated-index",
                "description": config["description"]
            }
        }
        
        with open(category_file, 'w', encoding='utf-8') as f:
            json.dump(category_config, f, ensure_ascii=False, indent=2)
        
        print(f"âœ¨ åˆ›å»ºæ–‡ä»¶: {category_file}")
    
    print("=" * 50)
    print("âœ… _category_.jsonæ–‡ä»¶è¡¥å…¨å®Œæˆï¼")

def update_sidebars_to_autogenerate():
    """å°†sidebars.jsæ›´æ–°ä¸ºè‡ªåŠ¨ç”Ÿæˆæ¨¡å¼"""
    
    sidebars_file = Path("sidebars.js")
    
    # æ–°çš„è‡ªåŠ¨ç”Ÿæˆçš„sidebars.jså†…å®¹
    new_content = """// @ts-check

// This runs in Node.js - Don't use client-side code here (browser APIs, JSX...)

/**
 * Creating a sidebar enables you to:
 - create an ordered group of docs
 - render a sidebar for each doc of that group
 - provide next/previous navigation

 The sidebars can be generated from the filesystem, or explicitly defined here.

 Create as many sidebars as you want.

 @type {import('@docusaurus/plugin-content-docs').SidebarsConfig}
 */
const sidebars = {
  // ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ä¾§è¾¹æ ï¼ŒåŸºäº_category_.jsonæ–‡ä»¶
  tutorialSidebar: [{type: 'autogenerated', dirName: '.'}],
};

export default sidebars;
"""
    
    # å¤‡ä»½åŸæ–‡ä»¶
    backup_file = Path("sidebars.js.backup")
    if sidebars_file.exists():
        import shutil
        shutil.copy2(sidebars_file, backup_file)
        print(f"ğŸ“ å¤‡ä»½åŸæ–‡ä»¶åˆ°: {backup_file}")
    
    # å†™å…¥æ–°å†…å®¹
    with open(sidebars_file, 'w', encoding='utf-8') as f:
        f.write(new_content)
    
    print(f"âœ¨ æ›´æ–°æ–‡ä»¶: {sidebars_file}")
    print("ğŸ”„ ç°åœ¨ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ä¾§è¾¹æ æ¨¡å¼")

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸš€ å¼€å§‹è¡¥å…¨LLMçŸ¥è¯†ä½“ç³»çš„_category_.jsonæ–‡ä»¶...")
    print()
    
    try:
        # 1. è¡¥å…¨ç¼ºå°‘çš„_category_.jsonæ–‡ä»¶
        create_missing_category_files()
        print()
        
        # 2. è¯¢é—®æ˜¯å¦è¦æ›´æ–°sidebars.jsä¸ºè‡ªåŠ¨ç”Ÿæˆæ¨¡å¼
        response = input("æ˜¯å¦è¦å°†sidebars.jsæ›´æ–°ä¸ºè‡ªåŠ¨ç”Ÿæˆæ¨¡å¼ï¼Ÿ(y/n): ").strip().lower()
        if response in ['y', 'yes', 'æ˜¯']:
            print()
            update_sidebars_to_autogenerate()
            print()
            print("ğŸ‰ å®Œæˆï¼ç°åœ¨æ‰€æœ‰ç›®å½•éƒ½æœ‰_category_.jsonæ–‡ä»¶ï¼Œ")
            print("   å¹¶ä¸”sidebars.jså·²æ›´æ–°ä¸ºè‡ªåŠ¨ç”Ÿæˆæ¨¡å¼ã€‚")
            print()
            print("ğŸ“‹ è‡ªåŠ¨ç”Ÿæˆçš„ä¾§è¾¹æ å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ˜¾ç¤º:")
            print("   1. intro.md")
            print("   2. llm-basics/ (LLMåŸºç¡€)")
            print("   3. llm-advanced/ (LLMè¿›é˜¶)")
            print("   4. llm-infra/ (LLMåŸºç¡€è®¾æ–½)")
            print("   5. llm-security/ (LLMå®‰å…¨ä¸é£é™©)")
            print("   6. llm-evaluation/ (LLMè¯„ä¼°ä¸æµ‹è¯•)")
            print("   7. llm-rag/ (æ£€ç´¢å¢å¼ºç”Ÿæˆ)")
            print("   8. llm-agents/ (æ™ºèƒ½ä»£ç†ä¸å·¥å…·ä½¿ç”¨)")
            print("   9. multimodal-ai/ (å¤šæ¨¡æ€AI)")
            print("   10. llm-development/ (LLMå¼€å‘å®è·µ)")
            print("   11. llm-applications/ (é¢†åŸŸç‰¹å®šåº”ç”¨)")
            print("   12. llm-research/ (å‰æ²¿ç ”ç©¶)")
        else:
            print()
            print("âœ… ä»…è¡¥å…¨äº†_category_.jsonæ–‡ä»¶")
            print("ğŸ’¡ å¦‚éœ€è‡ªåŠ¨ç”Ÿæˆä¾§è¾¹æ ï¼Œè¯·æ‰‹åŠ¨è¿è¡Œæ­¤è„šæœ¬å¹¶é€‰æ‹©'y'")
            
    except Exception as e:
        print(f"âŒ å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {e}")
        return 1
    
    return 0

if __name__ == "__main__":
    exit(main()) 