<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YAMY çŸ¥è¯†åº“ - åœ¨çº¿ç¼–è¾‘å™¨</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f5f5;
      }
      .cms-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .cms-header h1 {
        margin: 0;
        font-size: 24px;
        font-weight: 600;
      }
      .cms-header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 14px;
      }
      #nc-root {
        margin-top: 20px;
      }
      .debug-info {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px;
        border-radius: 5px;
        font-size: 12px;
        color: #666;
      }
      
      /* æš‚æ—¶ä¸éšè—ä»»ä½•å…ƒç´ ï¼Œä¿æŒåŸå§‹ç•Œé¢ */
    </style>
  </head>
  <body>
    <div class="cms-header">
      <h1>âœï¸ YAMY çŸ¥è¯†åº“ç¼–è¾‘å™¨</h1>
      <p>åœ¨çº¿ç¼–è¾‘ Markdown æ–‡æ¡£ï¼Œè‡ªåŠ¨åŒæ­¥åˆ° GitHub</p>
    </div>
    <div id="nc-root"></div>
    <div class="debug-info">
      <strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong>
      <div id="debug-status">æ­£åœ¨åŠ è½½ CMS...</div>
    </div>
    <!-- ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      // è°ƒè¯•å‡½æ•°
      function updateDebugStatus(message) {
        const debugDiv = document.getElementById('debug-status');
        if (debugDiv) {
          debugDiv.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }
        console.log(message);
      }
      
      // ç­‰å¾… CMS åŠ è½½å®Œæˆ
      function waitForCMS() {
        if (typeof CMS !== 'undefined') {
          updateDebugStatus('âœ… Decap CMS å·²åŠ è½½');
          initCMS();
        } else {
          updateDebugStatus('â³ ç­‰å¾… CMS åŠ è½½...');
          setTimeout(waitForCMS, 500);
        }
      }
      
      // æš‚æ—¶ä¸æ‰§è¡Œä»»ä½•éšè—æ“ä½œ
      
      // æ£€æŸ¥è®¤è¯çŠ¶æ€
      function checkAuthStatus() {
        // æ£€æŸ¥ localStorage ä¸­çš„è®¤è¯ä¿¡æ¯
        try {
          const authData = localStorage.getItem('netlify-cms-auth');
          const sessionAuth = sessionStorage.getItem('decap-cms-auth');
          
          if (authData) {
            updateDebugStatus('å‘ç° localStorage è®¤è¯ä¿¡æ¯: ' + authData);
          }
          if (sessionAuth) {
            updateDebugStatus('å‘ç° sessionStorage è®¤è¯ä¿¡æ¯: ' + sessionAuth);
          }
          
          // æ£€æŸ¥ URL hash ä¸­çš„è®¤è¯ä¿¡æ¯
          if (window.location.hash) {
            updateDebugStatus('URL hash: ' + window.location.hash);
          }
        } catch (e) {
          updateDebugStatus('æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥: ' + e.message);
        }
      }
      
      // åˆå§‹åŒ– CMS
      function initCMS() {
        try {
          updateDebugStatus('æ­£åœ¨åˆå§‹åŒ– CMS é…ç½®...');
          
          // å…ˆæ£€æŸ¥è®¤è¯çŠ¶æ€
          checkAuthStatus();
          
          // ç›‘å¬è®¤è¯æ¶ˆæ¯
          window.addEventListener('message', function(event) {
            updateDebugStatus('æ”¶åˆ°æ¶ˆæ¯: ' + JSON.stringify(event.data));
            
            // å¤„ç†å­—ç¬¦ä¸²æ ¼å¼çš„æ¶ˆæ¯
            if (typeof event.data === 'string' && event.data.startsWith('authorization:github:success')) {
              updateDebugStatus('âœ… æ”¶åˆ°è®¤è¯æˆåŠŸæ¶ˆæ¯ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰ï¼');
              setTimeout(() => {
                updateDebugStatus('æ­£åœ¨é‡æ–°åŠ è½½é¡µé¢...');
                location.reload();
              }, 1000);
            }
            // å¤„ç†å¯¹è±¡æ ¼å¼çš„æ¶ˆæ¯
            else if (typeof event.data === 'object' && event.data.type === 'authorization:github:success') {
              updateDebugStatus('âœ… æ”¶åˆ°è®¤è¯æˆåŠŸæ¶ˆæ¯ï¼ˆå¯¹è±¡æ ¼å¼ï¼‰ï¼');
              setTimeout(() => {
                updateDebugStatus('æ­£åœ¨é‡æ–°åŠ è½½é¡µé¢...');
                location.reload();
              }, 1000);
            }
            // å¤„ç†å…¶ä»–è®¤è¯ç›¸å…³æ¶ˆæ¯
            else if (typeof event.data === 'string' && event.data.includes('authorization')) {
              updateDebugStatus('ğŸ”„ æ”¶åˆ°è®¤è¯ç›¸å…³æ¶ˆæ¯: ' + event.data);
            }
          });
          
          updateDebugStatus('é…ç½®å·²å‡†å¤‡ï¼Œå¯åŠ¨ CMS...');
          
          // ä½¿ç”¨å¤–éƒ¨é…ç½®æ–‡ä»¶ config.ymlï¼Œä¸ä¼ å…¥å†…è”é…ç½®
          CMS.init();
          
          updateDebugStatus('âœ… CMS åˆå§‹åŒ–å®Œæˆï¼ç°åœ¨åº”è¯¥å¯ä»¥çœ‹åˆ°ç¼–è¾‘å™¨ç•Œé¢äº†ã€‚');
          
        } catch (error) {
          updateDebugStatus('âŒ CMS åˆå§‹åŒ–å¤±è´¥: ' + error.message);
          console.error('CMS åˆå§‹åŒ–é”™è¯¯:', error);
        }
      }
      
      // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æ£€æŸ¥
      document.addEventListener('DOMContentLoaded', function() {
        updateDebugStatus('é¡µé¢å·²åŠ è½½ï¼Œå¼€å§‹æ£€æŸ¥ CMS...');
        waitForCMS();
      });
    </script>
  </body>
</html> 